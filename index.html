<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>Speed Math</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Bookman Old Style;
      text-align: center;
      background: linear-gradient(#6ecfff, #e9f8ff);
      overflow: hidden;
    }

    #ui {
      position: relative;
      z-index: 10;
      padding-top: 16px;
    }

    h1 {
      font-size: 34px;
      color: #333;
      margin: 8px 0;
    }

    #question {
      font-size: 28px;
      font-weight: bold;
      margin: 10px 0;
    }

    input {
      font-size: 20px;
      padding: 10px 16px;
      width: 120px;
      border-radius: 16px;
      border: 1px solid #aaa;
      text-align: center;
    }

    button {
      font-size: 18px;
      padding: 12px 28px;
      border-radius: 18px;
      border: none;
      background: #5edc7a;
      color: white;
      margin-top: 10px;
    }

    #result {
      font-size: 20px;
      margin-top: 8px;
      min-height: 26px;
      font-weight: bold;
      color: #444;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }
  </style>
</head>

<body>

  <div id="ui">
    <h1>Speed Math</h1>
    <div id="question"></div>
    <input id="answer" type="number" inputmode="numeric" placeholder="Answer">
    <br>
    <button onclick="check()">Submit</button>
    <div id="result"></div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas")
    const ctx = canvas.getContext("2d")

    function resize() {
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight
    }
    window.addEventListener("resize", resize)
    resize()

    let a = 0
    let b = 0
    let score = 0
    let level = 1
    let season = "winter"
    let operator = "+"

    let treeCount = 2
    let flowerCount = 0
    let cloudCover = 80
    let leafDrops = 0
    let snowflakes = []

    for (let i = 0; i < 40; i++) {
      snowflakes.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        speed: 1 + Math.random()
      })
    }

    function setSeason() {
      if (level === 1) season = "winter"
      if (level === 2) season = "spring"
      if (level === 3) season = "summer"
      if (level === 4) season = "autumn"

      if (season === "winter") operator = "+"
      if (season === "spring") operator = "-"
      if (season === "summer") operator = "*"
      if (season === "autumn") operator = "/"
    }

    function newQuestion() {
      let max = 10 + level * 5
      a = Math.floor(Math.random() * max) + 1
      b = Math.floor(Math.random() * max) + 1

      if (operator === "-") {
        if (b > a) {
          let t = a
          a = b
          b = t
        }
      }

      if (operator === "/") {
        a = b * (Math.floor(Math.random() * 10) + 1)
      }

      let symbol = "+"
      if (operator === "-") symbol = "-"
      if (operator === "*") symbol = "ร"
      if (operator === "/") symbol = "รท"

      document.getElementById("question").innerText =
        a + " " + symbol + " " + b + " = ?"
    }

    function check() {
      const user = Number(document.getElementById("answer").value)

      let correct = 0
      if (operator === "+") correct = a + b
      if (operator === "-") correct = a - b
      if (operator === "*") correct = a * b
      if (operator === "/") correct = a / b

      if (user === correct) {
        score++

        if (season === "winter") treeCount++
        if (season === "spring") flowerCount++
        if (season === "summer") cloudCover -= 10
        if (season === "autumn") leafDrops++

        document.getElementById("result").innerText = "Great"
      } else {
        document.getElementById("result").innerText = "Try again"
      }

      if (score >= level * 5 && level < 4) {
        level++
        setSeason()
      }

      document.getElementById("answer").value = ""
    }

    function drawSky() {
      let grad = ctx.createLinearGradient(0, 0, 0, canvas.height)
      grad.addColorStop(0, "#7ddcff")
      grad.addColorStop(1, "#eaffe8")
      ctx.fillStyle = grad
      ctx.fillRect(0, 0, canvas.width, canvas.height)
    }

    function drawMountains() {
      ctx.fillStyle = "#9fd39f"
      ctx.beginPath()
      ctx.moveTo(0, canvas.height * 0.65)
      ctx.lineTo(canvas.width * 0.25, canvas.height * 0.45)
      ctx.lineTo(canvas.width * 0.5, canvas.height * 0.65)
      ctx.fill()
    }

    function drawGrass() {
      ctx.fillStyle = "#6bd66b"
      ctx.fillRect(0, canvas.height * 0.65, canvas.width, canvas.height)
    }

    function drawSunAndCloud() {
      let sunX = canvas.width - 120
      let sunY = 120

      ctx.beginPath()
      ctx.fillStyle = "#ffd93b"
      ctx.arc(sunX, sunY, 60, 0, Math.PI * 2)
      ctx.fill()

      ctx.fillStyle = "white"
      ctx.beginPath()
      ctx.arc(sunX - cloudCover, sunY, 30, 0, Math.PI * 2)
      ctx.arc(sunX - cloudCover + 35, sunY + 10, 30, 0, Math.PI * 2)
      ctx.arc(sunX - cloudCover - 35, sunY + 10, 30, 0, Math.PI * 2)
      ctx.fill()
    }

    function drawTrees() {
      for (let i = 0; i < treeCount; i++) {
        let x = 40 + i * 60
        let y = canvas.height * 0.65

        ctx.fillStyle = "#8b5a2b"
        ctx.fillRect(x, y - 40, 14, 40)

        ctx.beginPath()
        ctx.fillStyle = "#2ecc71"
        ctx.arc(x + 7, y - 50, 30, 0, Math.PI * 2)
        ctx.fill()
      }
    }

    function drawFlowers() {
      for (let i = 0; i < flowerCount; i++) {
        let x = 50 + i * 40
        let y = canvas.height * 0.65 + 20
        let colors = ["pink", "yellow", "purple"]
        ctx.beginPath()
        ctx.fillStyle = colors[i % 3]
        ctx.arc(x, y, 6, 0, Math.PI * 2)
        ctx.fill()
      }
    }

    function drawSnow() {
      snowflakes.forEach(s => {
        ctx.beginPath()
        ctx.fillStyle = "white"
        ctx.arc(s.x, s.y, 3, 0, Math.PI * 2)
        ctx.fill()

        s.y += s.speed
        if (s.y > canvas.height) {
          s.y = 0
          s.x = Math.random() * canvas.width
        }
      })
    }

    function drawLeaves() {
      for (let i = 0; i < leafDrops; i++) {
        let x = (i * 30) % canvas.width
        let y = (i * 20) % canvas.height

        ctx.beginPath()
        ctx.fillStyle = "orange"
        ctx.arc(x, y, 5, 0, Math.PI * 2)
        ctx.fill()
      }
    }

    function drawAll() {
      drawSky()
      drawMountains()
      drawGrass()
      drawSunAndCloud()
      drawTrees()

      if (season === "winter") drawSnow()
      if (season === "spring") drawFlowers()
      if (season === "autumn") drawLeaves()

      requestAnimationFrame(drawAll)
    }

    setSeason()
    newQuestion()
    drawAll()
  </script>

</body>
</html>
