<!DOCTYPE html>
<html lang="en">
<head>
  <title>Speed Math</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: "Bookman Old Style";
      text-align: center;
      background: linear-gradient(#87CEEB, #ffffff);
    }

    h1 {
      font-size: 32px;
      margin: 20px 0 10px 0;
    }

    #question {
      font-size: 26px;
      margin: 10px;
      font-weight: bold;
    }

    input {
      font-size: 20px;
      padding: 10px;
      width: 120px;
      border-radius: 10px;
      border: 1px solid #999;
      text-align: center;
    }

    button {
      font-size: 18px;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      background: #4CAF50;
      color: white;
    }

    #result {
      font-size: 20px;
      margin-top: 10px;
      min-height: 24px;
      font-weight: bold;
    }

    canvas {
      width: 95vw;
      max-width: 700px;
      height: auto;
      border: 2px solid black;
      margin: 20px auto;
      display: block;
      border-radius: 16px;
      background: lightblue;
    }

    @media (max-width: 600px) {
      h1 { font-size: 26px; }
      #question { font-size: 22px; }
      input { width: 100px; font-size: 18px; }
      button { font-size: 16px; }
    }
  </style>
</head>

<body>

  <h1>Speed Math</h1>
  <div id="question"></div>

  <div>
    <input id="answer" type="number" inputmode="numeric" placeholder="Answer">
    <br><br>
    <button onclick="check()">Submit</button>
  </div>

  <p id="result"></p>

  <canvas id="gameCanvas" width="700" height="400"></canvas>

  <script>
    let a = 0
    let b = 0
    let score = 0
    let level = 1
    let season = "winter"
    let operator = "+"

    let treeCount = 1
    let flowerCount = 0
    let cloudOffset = 0
    let leaves = []

    const canvas = document.getElementById("gameCanvas")
    const ctx = canvas.getContext("2d")

    function setSeason() {
      if (level === 1) season = "winter"
      if (level === 2) season = "spring"
      if (level === 3) season = "summer"
      if (level === 4) season = "autumn"

      setOperator()
      drawScene()
      newQuestion()
    }

    function setOperator() {
      if (season === "winter") operator = "+"
      if (season === "spring") operator = "-"
      if (season === "summer") operator = "*"
      if (season === "autumn") operator = "/"
    }

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height)

      if (season === "winter") {
        canvas.style.background = "#b3e5ff"
        ctx.fillStyle = "white"
        ctx.fillRect(0, 280, 700, 120)

        for (let i = 0; i < treeCount; i++) {
          ctx.fillStyle = "#7b4a12"
          ctx.fillRect(80 + i * 90, 210, 24, 90)

          ctx.beginPath()
          ctx.fillStyle = "#1e8f44"
          ctx.arc(92 + i * 90, 200, 40, 0, Math.PI * 2)
          ctx.fill()
        }
      }

      if (season === "spring") {
        canvas.style.background = "#ccf5ff"
        ctx.fillStyle = "#5fd35f"
        ctx.fillRect(0, 280, 700, 120)

        for (let i = 0; i < flowerCount; i++) {
          ctx.beginPath()
          ctx.fillStyle = ["pink", "yellow", "purple"][i % 3]
          ctx.arc(40 + i * 35, 320, 8, 0, Math.PI * 2)
          ctx.fill()
        }
      }

      if (season === "summer") {
        canvas.style.background = "#87cefa"
        ctx.fillStyle = "#f4d27a"
        ctx.fillRect(0, 280, 700, 120)

        ctx.beginPath()
        ctx.fillStyle = "yellow"
        ctx.arc(600, 80, 45, 0, Math.PI * 2)
        ctx.fill()

        ctx.fillStyle = "white"
        ctx.fillRect(500 - cloudOffset, 50, 120, 40)
      }

      if (season === "autumn") {
        canvas.style.background = "#ffd8b0"
        ctx.fillStyle = "#d2a679"
        ctx.fillRect(0, 280, 700, 120)

        leaves.forEach((leaf, i) => {
          ctx.beginPath()
          ctx.fillStyle = ["orange", "red", "brown"][i % 3]
          ctx.arc(leaf.x, leaf.y, 6, 0, Math.PI * 2)
          ctx.fill()
          leaf.y += 2

          if (leaf.y > 340) {
            leaves.splice(i, 1)
          }
        })
      }
    }

    function newQuestion() {
      let max = 10 + level * 5

      a = Math.floor(Math.random() * max) + 1
      b = Math.floor(Math.random() * max) + 1

      if (operator === "-" && b > a) {
        let t = a
        a = b
        b = t
      }

      if (operator === "/" && b !== 0) {
        a = b * (Math.floor(Math.random() * 10) + 1)
      }

      document.getElementById("question").innerText =
        a + " " + symbol() + " " + b + " = ?"
    }

    function symbol() {
      if (operator === "+") return "+"
      if (operator === "-") return "-"
      if (operator === "*") return "ร"
      if (operator === "/") return "รท"
    }

    function check() {
      let user = Number(document.getElementById("answer").value)
      let correct = 0

      if (operator === "+") correct = a + b
      if (operator === "-") correct = a - b
      if (operator === "*") correct = a * b
      if (operator === "/") correct = a / b

      if (user === correct) {
        score++

        if (season === "winter") treeCount++
        if (season === "spring") flowerCount++
        if (season === "summer") cloudOffset += 20
        if (season === "autumn") leaves.push({ x: Math.random() * 700, y: 0 })

        document.getElementById("result").innerText = "Great job!"
      } else {
        document.getElementById("result").innerText = "Try again!"
      }

      if (score % 5 === 0 && level < 4) {
        level++
        setSeason()
      }

      document.getElementById("answer").value = ""

      drawScene()
      newQuestion()
    }

    setSeason()
  </script>

</body>
</html>
