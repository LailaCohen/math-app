<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>Speed Math</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: "Bookman Old Style";
      margin: 0;
      text-align: center;
      overflow: hidden;
      background: linear-gradient(#87CEEB, #ffffff);
    }

    #ui {
      position: relative;
      z-index: 5;
      padding-top: 20px;
    }

    #question {
      font-size: 26px;
      margin: 10px;
      font-weight: bold;
    }

    input {
      font-size: 20px;
      padding: 10px;
      width: 120px;
      border-radius: 12px;
      border: 1px solid #888;
      text-align: center;
    }

    button {
      font-size: 18px;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      background: #4CAF50;
      color: white;
      margin-top: 10px;
    }

    #result {
      font-size: 20px;
      margin-top: 10px;
      min-height: 24px;
      font-weight: bold;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }

    @media (max-width: 600px) {
      #question { font-size: 22px; }
      input { font-size: 16px; width: 90px; }
      button { font-size: 16px; }
    }
  </style>
</head>

<body>

  <div id="ui">
    <h1>Speed Math</h1>
    <div id="question"></div>
    <input id="answer" type="number" inputmode="numeric" placeholder="Answer">
    <br>
    <button onclick="check()">Submit</button>
    <p id="result"></p>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas")
    const ctx = canvas.getContext("2d")

    function resizeCanvas() {
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight
      drawScene()
    }
    window.addEventListener("resize", resizeCanvas)

    let trees = []
    let flowers = []
    let leaves = []
    let snowflakes = []

    let mountains = [
      {x: 0, y: 0.75},
      {x: 0.25, y: 0.75},
      {x: 0.5, y: 0.75}
    ]

    let birds = [
      {x: 200, y: 150},
      {x: 350, y: 120}
    ]

    let cloudOffset = 0

    function createTrees(num) {
      for (let i = 0; i < num; i++) {
        trees.push({
          x: Math.random() * window.innerWidth,
          y: window.innerHeight - 100
        })
      }
    }
    createTrees(10)

    function drawBackground() {
      ctx.fillStyle = "#9ad9ff"
      ctx.fillRect(0, 0, canvas.width, canvas.height)

      ctx.fillStyle = "#2e8b57"
      ctx.fillRect(0, canvas.height - 100, canvas.width, 100)
    }

    function drawMountains() {
      ctx.fillStyle = "#b5651d"
      mountains.forEach(m => {
        let baseY = canvas.height * m.y
        ctx.beginPath()
        ctx.moveTo(m.x * canvas.width, baseY)
        ctx.lineTo((m.x + 0.2) * canvas.width, baseY - 200)
        ctx.lineTo((m.x + 0.4) * canvas.width, baseY)
        ctx.closePath()
        ctx.fill()
      })
    }

    function drawSunAndCloud() {
      ctx.beginPath()
      ctx.fillStyle = "yellow"
      ctx.arc(canvas.width - 100, 100, 50, 0, Math.PI*2)
      ctx.fill()

      ctx.fillStyle = "white"
      ctx.beginPath()
      ctx.arc(canvas.width - 160 + cloudOffset, 100, 30, 0, Math.PI*2)
      ctx.arc(canvas.width - 130 + cloudOffset, 110, 30, 0, Math.PI*2)
      ctx.arc(canvas.width - 190 + cloudOffset, 110, 30, 0, Math.PI*2)
      ctx.fill()
    }

    function drawBirds() {
      ctx.strokeStyle = "black"
      birds.forEach(b => {
        ctx.beginPath()
        ctx.moveTo(b.x, b.y)
        ctx.lineTo(b.x + 15, b.y - 8)
        ctx.lineTo(b.x + 30, b.y)
        ctx.stroke()
      })
    }

    function drawTree(x, y) {
      ctx.fillStyle = "#7b4a12"
      ctx.fillRect(x - 8, y - 40, 16, 40)

      ctx.fillStyle = "#228b22"
      ctx.beginPath()
      ctx.arc(x, y - 50, 25, 0, Math.PI * 2)
      ctx.fill()
    }

    function drawForest() {
      trees.forEach(t => drawTree(t.x, t.y))
    }

    function drawSnow() {
      snowflakes.forEach(s => {
        ctx.beginPath()
        ctx.fillStyle = "white"
        ctx.arc(s.x, s.y, 3, 0, Math.PI * 2)
        ctx.fill()
        s.y += 2
        if (s.y > canvas.height) s.y = 0
      })
    }

    function drawFlowers() {
      flowers.forEach(f => {
        ctx.beginPath()
        ctx.fillStyle = f.color
        ctx.arc(f.x, f.y, 5, 0, Math.PI * 2)
        ctx.fill()
      })
    }

    function drawLeaves() {
      leaves.forEach((l, i) => {
        ctx.beginPath()
        ctx.fillStyle = ["orange", "red", "brown"][i % 3]
        ctx.arc(l.x, l.y, 6, 0, Math.PI * 2)
        ctx.fill()
        l.y += 2
        if (l.y > canvas.height - 100) leaves.splice(i, 1)
      })
    }

    let level = 1
    let season = "winter"
    let operator = "+"
    let a = 0
    let b = 0
    let score = 0

    function setSeason() {
      if (level === 1) season = "winter"
      if (level === 2) season = "spring"
      if (level === 3) season = "summer"
      if (level === 4) season = "autumn"
      setOperator()
    }

    function setOperator() {
      if (season === "winter") operator = "+"
      if (season === "spring") operator = "-"
      if (season === "summer") operator = "*"
      if (season === "autumn") operator = "/"
    }

    function drawScene() {
      drawBackground()
      drawMountains()
      drawSunAndCloud()
      drawBirds()
      drawForest()

      if (season === "winter") drawSnow()
      if (season === "spring") drawFlowers()
      if (season === "autumn") drawLeaves()
    }

    function newQuestion() {
      let max = 10 + level * 5
      a = Math.floor(Math.random() * max) + 1
      b = Math.floor(Math.random() * max) + 1

      if (operator === "-" && b > a) {
        let t = a
        a = b
        b = t
      }

      if (operator === "/" && b !== 0) {
        a = b * (Math.floor(Math.random() * 10) + 1)
      }

      let symbol = "+"
      if (operator === "-") symbol = "-"
      if (operator === "*") symbol = "ร"
      if (operator === "/") symbol = "รท"

      document.getElementById("question").innerText =
        a + " " + symbol + " " + b + " = ?"
    }

    function check() {
      const user = Number(document.getElementById("answer").value)

      let correct = 0
      if (operator === "+") correct = a + b
      if (operator === "-") correct = a - b
      if (operator === "*") correct = a * b
      if (operator === "/") correct = a / b

      if (user === correct) {
        score++

        if (season === "winter") {
          trees.push({x: Math.random()*canvas.width, y: canvas.height-100})
          snowflakes.push({x: Math.random()*canvas.width, y: 0})
        }
        if (season === "spring") {
          flowers.push({x: Math.random()*canvas.width, y: canvas.height-80, color: "pink"})
        }
        if (season === "summer") {
          cloudOffset += 20
        }
        if (season === "autumn") {
          leaves.push({x: Math.random()*canvas.width, y: 0})
        }

        document.getElementById("result").innerText = "Correct"
      } else {
        document.getElementById("result").innerText = "Try again"
      }

      if (score % 5 === 0 && level < 4) {
        level++
        setSeason()
      }

      document.getElementById("answer").value = ""
      drawScene()
      newQuestion()
    }

    for (let i = 0; i < 40; i++) {
      snowflakes.push({x: Math.random()*window.innerWidth, y: Math.random()*window.innerHeight})
    }

    resizeCanvas()
    setSeason()
    newQuestion()

    function animate() {
      drawScene()
      requestAnimationFrame(animate)
    }
    animate()
  </script>

</body>
</html>
